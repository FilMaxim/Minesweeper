(()=>{"use strict";const e=function(e,t){localStorage.setItem(e,JSON.stringify(t))},t=document.createElement("div");t.classList.add("modal-record");const a=document.createElement("div");a.classList.add("modal-record__wrapper");const s=document.createElement("h2");s.classList.add("modal-record__title"),s.textContent="Records";const n=document.createElement("table");n.classList.add("modal-record__list");const c=document.createElement("thead"),o=document.createElement("tr");["Time, s","Difficulty","Mines","Steps"].forEach((e=>{const t=document.createElement("td");t.textContent=e,o.append(t)})),c.append(o);const l=document.createElement("tbody");n.append(c,l);const i=document.createElement("button");i.classList.add("modal-record__close"),i.innerHTML="CLOSE",a.append(s,n,i),t.append(a);const d=JSON.parse(localStorage.getItem("level"))||"easy",r=JSON.parse(localStorage.getItem("MINE"))||10,m=document.createElement("div");m.classList.add("modal-setting");const u=document.createElement("ul");u.classList.add("modal-setting__list");const p=document.createElement("li");p.classList.add("modal-setting__item");const v=document.createElement("p");v.classList.add("setting-title"),v.textContent="Difficulty:";const g=document.createElement("select");g.classList.add("size__select");const L=document.createElement("option");L.value="easy",L.textContent="easy";const E=document.createElement("option");E.value="medium",E.textContent="medium";const f=document.createElement("option");f.value="hard",f.textContent="hard",L.selected=d===L.value,E.selected=d===E.value,f.selected=d===f.value,g.append(L,E,f),p.append(v,g);const b=document.createElement("li");b.classList.add("modal-setting__item");const S=document.createElement("p");S.textContent="Count of mines:";const _=document.createElement("select");_.classList.add("size__select");for(let e=10;e<100;e+=1){const t=document.createElement("option");t.value=e,t.textContent=e,e===Number(r)&&(t.selected=!0),_.append(t)}b.append(S,_);const h=document.createElement("li");h.classList.add("modal-setting__item");const y=document.createElement("p");y.textContent="Theme:";const C=document.createElement("label");C.classList.add("checkbox-theme");const x=document.createElement("input");x.type="checkbox";const k=document.createElement("span");k.classList.add("checkbox-switch"),C.append(x,k),h.append(y,C);const I=document.createElement("li");I.classList.add("modal-setting__item");const N=document.createElement("p");N.textContent="Sound:";const M=document.createElement("label");M.classList.add("checkbox-theme");const O=document.createElement("input");O.type="checkbox";const w=document.createElement("span");w.classList.add("checkbox-switch"),M.append(O,w),I.append(N,M);const T=document.createElement("li");T.classList.add("modal-setting__item");const J=document.createElement("button");J.classList.add("modal-record__close"),J.textContent="Records",T.append(J),u.append(p,b,h,I),m.append(u,T);let H=JSON.parse(localStorage.getItem("statusTheme"))||!1;x.checked=H,H?document.documentElement.setAttribute("data-theme","dark"):document.documentElement.setAttribute("data-theme","light"),C.addEventListener("change",(()=>{console.log(C.checked),H?(document.documentElement.setAttribute("data-theme","light"),H=!H):(document.documentElement.setAttribute("data-theme","dark"),H=!H),e("statusTheme",H)}));const A=document.createElement("div");A.classList.add("popap");const D=document.createElement("div");D.classList.add("victory");const R=document.createElement("span");R.classList.add("title-result"),R.textContent="You won!!! Congratulation";const F=document.createElement("div");F.classList.add("victory__wrapper");const G=document.createElement("button");G.classList.add("modal-record__close"),G.innerHTML="Continue";const $=document.createElement("button");$.classList.add("modal-record__close"),$.innerHTML="Try again",F.append(G,$),D.append(R,F);const z={easy:10,medium:15,hard:25};let Y,q=JSON.parse(localStorage.getItem("level"))||"easy",W=z[q],j=z[q],B=JSON.parse(localStorage.getItem("MINE"))||10,K=JSON.parse(localStorage.getItem("statusFirstClick"))||!1,P=JSON.parse(localStorage.getItem("arrMines")),Q=JSON.parse(localStorage.getItem("countOpen"))||W**2;const U=document.querySelector("body"),V=document.createElement("h1");V.classList.add("title"),V.textContent="Minesweeper";const X=document.createElement("div");X.classList.add("wrapper");const Z=document.createElement("div");Z.classList.add("buttonsSetting");const ee=document.createElement("input");ee.classList.add("buttonsSetting__input"),ee.type="text",ee.value=JSON.parse(localStorage.getItem("timeSave"))||"000",ee.id="timer",ee.disabled=!0;const te=document.createElement("button");te.classList.add("buttonsSetting__newGame"),te.type="submit",te.innerHTML="new game";const ae=document.createElement("input");ae.classList.add("buttonsSetting__input"),ae.type="text",ae.value=JSON.parse(localStorage.getItem("numberOfClicks"))||"000",ae.disabled=!0;const se=document.createElement("button");se.classList.add("buttonsSetting__setting"),se.addEventListener("click",(()=>{se.classList.toggle("buttonsSetting__setting--active"),m.classList.toggle("modal-setting--active"),A.classList.toggle("popap--active"),U.classList.toggle("unscroll")})),A.addEventListener("click",(()=>{m.classList.contains("modal-setting--active")&&(se.classList.remove("buttonsSetting__setting--active"),m.classList.remove("modal-setting--active"),A.classList.remove("popap--active"),U.classList.remove("unscroll"))}));const ne=JSON.parse(localStorage.getItem("arrResult"))||[];J.addEventListener("click",(()=>{var e;e=ne,l.innerHTML="",0!==e.length&&e.forEach((t=>{const a=document.createElement("tr");e[0].forEach(((e,s)=>{const n=document.createElement("td");n.textContent=t[s],a.append(n)})),l.append(a)})),t.classList.add("modal-record--active"),m.classList.contains("modal-setting--active")&&(se.classList.remove("buttonsSetting__setting--active"),m.classList.remove("modal-setting--active")),U.classList.add("unscroll")})),i.addEventListener("click",(()=>{A.classList.remove("popap--active"),t.classList.remove("modal-record--active"),U.classList.remove("unscroll")}));let ce=!1,oe=new Audio;function le(e,t){t||(oe.pause(),oe=new Audio(e),oe.volume=.9,oe.play())}I.addEventListener("change",(()=>{ce=!ce})),Z.append(ee,te,ae,se,m);const ie=document.createElement("div");let de;function re(){ee.value=(Number(ee.value)+1).toString().padStart(3,"0")}function me(e,t,a){const s=e*t;ie.firstChild&&ie.firstChild.remove();const n=document.createElement("div");n.classList.add("field"),n.innerHTML=JSON.parse(localStorage.getItem("fieldSave"))||'<button class="field__botton"></button>'.repeat(s),n.setAttribute("level",`${q}`),ie.append(n);const c=[...n.children],o=(e,t)=>{if(!(e>0&&t>0&&e<=W&&t<=j))return!1;const a=e*W+t-W;return P.includes(a)},l=(e,t)=>{const a=e*W+t-W-1;if(!(e>0&&t>0&&e<=W&&t<=j))return;if(c[a].classList.contains("field-flag"))return;if(c[a].disabled)return void c[a].classList.remove("field-flag");const s=((e,t)=>{let a=0;for(let s=-1;s<=1;s+=1)for(let n=-1;n<=1;n+=1)o(e+s,t+n)&&(a+=1);return a})(e,t);if(o(e,t))return c[a].classList.remove("field-flag"),c[a].style.border="2px solid red",c[a].disabled=!0,P.forEach((e=>{c[e-1].classList.add("field-mine")})),D.classList.add("victory--active"),D.firstChild.textContent="Game over. Try again",G.classList.add("victory-btn--noactive"),K=!K,A.classList.toggle("popap--active"),le("images/bang.mp3",ce),void clearInterval(de);if(0!==s&&(c[a].innerHTML=s,1===s&&(c[a].style.color="blue"),2===s&&(c[a].style.color="green"),3===s&&(c[a].style.color="red"),4===s&&(c[a].style.color="rgb(49, 5, 100)"),5===s&&(c[a].style.color="green"),6===s&&(c[a].style.color="broun"),7===s&&(c[a].style.color="rgb(0, 238, 255)"),8===s&&(c[a].style.color="rgb(251, 11, 175)"),c[a].disabled=!0),0===s){c[a].innerHTML="",c[a].disabled=!0;for(let a=-1;a<=1;a+=1)for(let s=-1;s<=1;s+=1)l(e+a,t+s)}Q-=1,Q<=B&&(D.classList.add("victory--active"),D.firstChild.textContent=`Hooray! You found all the mines in ${Number(ee.value)} seconds and ${Number(ae.value)} moves!`,G.classList.add("victory-btn--noactive"),K=!K,A.classList.toggle("popap--active"),le("images/victory.mp3",ce),ne.unshift([Number(ee.value),q,B,Number(ae.value)]),ne.length>10&&ne.pop(),clearInterval(de))};n.addEventListener("click",(e=>{if(!e.target.classList.contains("field__botton"))return;if(e.target.classList.contains("field-flag"))return;le("images/click.mp3",ce);const t=e.target,n=c.indexOf(t),o=Math.floor(n/j)+1,i=Math.floor(n%j)+1;if(ae.value=(Number(ae.value)+1).toString().padStart(3,"0"),!K){const e=(()=>{let e=[...Array(s).keys()];return e=e.map((e=>e+1)),e=e.sort((()=>Math.random()-.5)),e=e.sort((()=>Math.random()-.5)),e})().filter((e=>e!==n+1));P=e.slice(0,a),K=!0,de=setInterval(re,1e3)}l(o,i)})),n.addEventListener("contextmenu",(e=>{e.preventDefault(),le("images/flag.mp3",ce);const t=e.target;e.target.classList.contains("field__botton")&&(e.target.disabled||t.classList.toggle("field-flag"))}))}function ue(){clearInterval(de),localStorage.removeItem("fieldSave"),localStorage.removeItem("arrMines"),localStorage.removeItem("statusFirstClick"),localStorage.removeItem("countOpen"),Q=W**2,localStorage.removeItem("timeSave"),localStorage.removeItem("numberOfClicks"),ae.value="000",ee.value="000",K=!1,me(W,j,B),D.classList.remove("victory--active")}ie.classList.add("fieldwrapper"),X.append(Z,ie),U.append(V,X,A,D,t),te.addEventListener("click",(()=>{A.classList.remove("popap--active"),ue()})),$.addEventListener("click",(()=>{A.classList.remove("popap--active"),ue()})),G.addEventListener("click",(()=>{D.classList.remove("victory--active"),A.classList.remove("popap--active"),de=setInterval(re,1e3)})),g.addEventListener("change",(()=>{q=g.value,W=z[q],j=z[q],ue()})),_.addEventListener("change",(()=>{B=_.value,ue()})),me(W,j,B),window.addEventListener("beforeunload",(()=>{e("level",q),e("MINE",B),e("statusFirstClick",K),e("arrResult",ne),K?(Y=ie.firstChild,e("fieldSave",Y.innerHTML),P&&e("arrMines",P),e("countOpen",Q),e("timeSave",ee.value),e("numberOfClicks",ae.value)):ue()})),window.addEventListener("DOMContentLoaded",(()=>{K&&(D.classList.add("victory--active"),$.textContent="New Game",D.firstChild.textContent="Would you like to continue?",A.classList.add("popap--active"),G.classList.remove("victory-btn--noactive"))}))})();